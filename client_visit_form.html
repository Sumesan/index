<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Visit Information</title>
</head>
<body>
    <h2>Client Visit Information Form</h2>
    <form id="clientVisitForm" onsubmit="submitForm(event)">
        <div>
            <label for="outworx_contact">Outworx Point of Contact:</label>
            <input type="text" id="outworx_contact" name="outworx_contact">
        </div>
        <div>
            <label for="campaign">Campaign:</label>
            <input type="text" id="campaign" name="campaign">
        </div>
        <div>
            <label for="num_guests">Number of Guests:</label>
            <select id="num_guests" name="num_guests" onchange="generateGuestFields()">
                <option value="">Select</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
            </select>
        </div>
        <div id="guestFieldsContainer"></div>
        <button type="submit">Submit</button>
    </form>

    <script>
        function submitForm(event) {
            event.preventDefault(); // Prevent default form submission

            // Get data from the form
            var formData = {
                "outworx_contact": document.getElementById('outworx_contact').value,
                "campaign": document.getElementById('campaign').value,
                "num_guests": document.getElementById('num_guests').value,
                "guests": []
            };

            // Add guest information to formData
            var numGuests = parseInt(formData.num_guests);
            for (var i = 1; i <= numGuests; i++) {
                var guestData = {
                    "name": document.getElementById(`guest_name_${i}`).value,
                    "email": document.getElementById(`guest_email_${i}`).value,
                    "mobile": document.getElementById(`guest_mobile_${i}`).value,
                    "sa_phone": document.getElementById(`sa_phone_${i}`).value,
                    "arrival_airline": document.getElementById(`arrival_airline_${i}`).value,
                    "arrival_flight": document.getElementById(`arrival_flight_${i}`).value,
                    "arrival_date": document.getElementById(`arrival_date_${i}`).value,
                    "arrival_time": document.getElementById(`arrival_time_${i}`).value,
                    "departure_airline": document.getElementById(`departure_airline_${i}`).value,
                    "departure_flight": document.getElementById(`departure_flight_${i}`).value,
                    "departure_date": document.getElementById(`departure_date_${i}`).value,
                    "departure_time": document.getElementById(`departure_time_${i}`).value,
                    "hotel": document.getElementById(`hotel_${i}`).value,
                    "driver_required": document.getElementById(`driver_required_${i}`).value,
                    "special_requirements": document.getElementById(`special_requirements_${i}`).value,
                    "activities_interested": Array.from(document.querySelectorAll(`#activities_interested_${i} input[type=checkbox]:checked`)).map(function(element) {
                        return element.value;
                    })
                };
                formData.guests.push(guestData);
            }

            // Send formData as JSON using fetch API
            fetch('https://prod-105.westeurope.logic.azure.com:443/workflows/ba96034e3d084c9cbeac129011bf7c31/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=y_f3WsxSVyHGOPsoZwbQV_w2Nmb-1eQ2yolV9AptyA8', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => {
                // Handle response if needed
                console.log('Response received:', response);
            })
            .catch(error => {
                // Handle error if needed
                console.error('Error occurred:', error);
            });
        }

        function generateGuestFields() {
            var numGuests = parseInt(document.getElementById('num_guests').value);
            var guestFieldsContainer = document.getElementById('guestFieldsContainer');
            guestFieldsContainer.innerHTML = '';

            for (var i = 1; i <= numGuests; i++) {
                var guestFieldset = document.createElement('fieldset');
                guestFieldset.innerHTML = `
                    <legend>Guest ${i} Information</legend>
                    <div>
                        <label for="guest_name_${i}">Name:</label>
                        <input type="text" id="guest_name_${i}" name="guest_name_${i}">
                    </div>
                    <div>
                        <label for="guest_email_${i}">Email:</label>
                        <input type="email" id="guest_email_${i}" name="guest_email_${i}">
                    </div>
                    <div>
                        <label for="guest_mobile_${i}">Mobile Number:</label>
                        <input type="tel" id="guest_mobile_${i}" name="guest_mobile_${i}">
                    </div>
                    <div>
                        <label for="sa_phone_${i}">Require South African phone?</label>
                        <select id="sa_phone_${i}" name="sa_phone_${i}">
                            <option value="yes">Yes</option>
                            <option value="no">No</option>
                        </select>
                    </div>
                    <div>
                        <label for="arrival_airline_${i}">Arrival Airline:</label>
                        <input type="text" id="arrival_airline_${i}" name="arrival_airline_${i}">
                    </div>
                    <div>
                        <label for="arrival_flight_${i}">Arrival Flight Number:</label>
                        <input type="text" id="arrival_flight_${i}" name="arrival_flight_${i}">
                    </div>
                    <div>
                        <label for="arrival_date_${i}">Date of Flight Arrival:</label>
                        <input type="date" id="arrival_date_${i}" name="arrival_date_${i}">
                    </div>
                    <div>
                        <label for="arrival_time_${i}">Time of Flight Arrival:</label>
                        <input type="time" id="arrival_time_${i}" name="arrival_time_${i}">
                    </div>
                    <div>
                        <label for="departure_airline_${i}">Departure Airline:</label>
                        <input type="text" id="departure_airline_${i}" name="departure_airline_${i}">
                    </div>
                    <div>
                        <label for="departure_flight_${i}">Departure Flight Number:</label>
                        <input type="text" id="departure_flight_${i}" name="departure_flight_${i}">
                    </div>
                    <div>
                        <label for="departure_date_${i}">Date of Flight Departure:</label>
                        <input type="date" id="departure_date_${i}" name="departure_date_${i}">
                    </div>
                    <div>
                        <label for="departure_time_${i}">Time of Flight Departure:</label>
                        <input type="time" id="departure_time_${i}" name="departure_time_${i}">
                    </div>
                    <div>
                        <label for="hotel_${i}">Name of the Hotel:</label>
                        <input type="text" id="hotel_${i}" name="hotel_${i}">
                    </div>
                    <div>
                        <label for="driver_required_${i}">Driver Required?</label>
                        <select id="driver_required_${i}" name="driver_required_${i}" onchange="toggleDriverTimes(this, ${i})">
                            <option value="no">No</option>
                            <option value="yes">Yes</option>
                        </select>
                    </div>
                    <div id="driverTimes_${i}" style="display: none;">
                        <div>
                            <label for="daily_collection_time_${i}">Daily Collection Time:</label>
                            <input type="time" id="daily_collection_time_${i}" name="daily_collection_time_${i}">
                        </div>
                        <div>
                            <label for="daily_dropoff_time_${i}">Daily Drop off Time:</label>
                            <input type="time" id="daily_dropoff_time_${i}" name="daily_dropoff_time_${i}">
                        </div>
                    </div>
                    <div>
                        <label for="special_requirements_${i}">Special Requirements:</label>
                        <textarea id="special_requirements_${i}" name="special_requirements_${i}" rows="4"></textarea>
                    </div>
                    <div>
                        <label>Activities Interested In:</label>
                        <div class="checkbox-container">
                            <input type="checkbox" id="activity_ushaka_${i}" name="activity_ushaka_${i}" value="Ushaka Marine World (Shark Cage Diving/Snorkeling)">
                            <label for="activity_ushaka_${i}">Ushaka Marine World (Shark Cage Diving/Snorkeling)</label>
                            <input type="checkbox" id="activity_zulu_${i}" name="activity_zulu_${i}" value="Zulu Kingdom Tour">
                            <label for="activity_zulu_${i}">Zulu Kingdom Tour</label>
                            <input type="checkbox" id="activity_segway_${i}" name="activity_segway_${i}" value="Segway Tour">
                            <label for="activity_segway_${i}">Segway Tour</label>
                            <input type="checkbox" id="activity_safari_${i}" name="activity_safari_${i}" value="Safari Tour">
                            <label for="activity_safari_${i}">Safari Tour</label>
                        </div>
                    </div>
                `;

                guestFieldsContainer.appendChild(guestFieldset);
            }
        }

        function toggleDriverTimes(selectElement, index) {
            var driverTimesDiv = document.getElementById(`driverTimes_${index}`);
            if (selectElement.value === "yes") {
                driverTimesDiv.style.display = "block";
            } else {
                driverTimesDiv.style.display = "none";
            }
        }
    </script>
</body>
</html>

